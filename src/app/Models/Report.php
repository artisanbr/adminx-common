<?php

namespace ArtisanBR\Adminx\Common\App\Models;

use ArtisanBR\Adminx\Common\App\Enums\core\ReportType;
use ArtisanBR\Adminx\Common\App\Models\Bases\EloquentModelBase;
use ArtisanBR\Adminx\Common\App\Models\Interfaces\OwneredModel;
use ArtisanBR\Adminx\Common\App\Models\Interfaces\PublicIdModel;
use ArtisanBR\Adminx\Common\App\Models\Scopes\WhereSiteScope;
use ArtisanBR\Adminx\Common\App\Models\Traits\HasOwners;
use ArtisanBR\Adminx\Common\App\Models\Traits\HasPublicIdAttribute;
use ArtisanBR\Adminx\Common\App\Models\Traits\HasPublicIdUriAttributes;
use ArtisanBR\Adminx\Common\App\Models\Traits\HasSlugAttribute;
use ArtisanBR\Adminx\Common\App\Models\Traits\HasUriAttributes;
use ArtisanBR\Adminx\Common\App\Models\Traits\HasValidation;
use ArtisanBR\Adminx\Common\App\Models\Traits\Relations\BelongsToSite;
use ArtisanBR\Adminx\Common\App\Models\Traits\Relations\BelongsToUser;
use ArtisanBR\Adminx\Common\App\Models\Traits\Relations\HasCategoriesMorph;
use Illuminate\Database\Eloquent\Builder;

class Report extends EloquentModelBase implements PublicIdModel, OwneredModel
{
    use HasUriAttributes, HasSlugAttribute, HasCategoriesMorph, BelongsToSite, BelongsToUser, HasPublicIdAttribute, HasPublicIdUriAttributes, HasOwners, HasValidation;

    protected $fillable = [
        'site_id',
        'user_id',
        'account_id',
        'title',
        'slug',
        'type',
        'description',
        'content',
        'tags',
        'published_at',
    ];

    protected $casts = [
        'title'        => 'string',
        'slug'        => 'string',
        'type'           => ReportType::class,
        'description'       => 'string',
        'content'       => 'string',
        'tags'       => 'collection',
        'published_at'   => 'datetime:d/m/Y H:i:s',
    ];

    protected $appends = [
        'url',
    ];

    protected $attributes = [
        'type' => 'info',
    ];

    protected array $ownerTypes = ['user'];

    //region SCOPES


    //endregion

    //region OVERRIDES
    protected static function booted()
    {
        static::addGlobalScope(new WhereSiteScope);

        static::addGlobalScope('public', function (Builder $builder) {
            $builder->orWhere('site_id', null);
        });
    }

    public function save(array $options = [])
    {
        return parent::save($options); // TODO: Change the autogenerated stub
    }
    //endregion
}
